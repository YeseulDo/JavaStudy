# JAVA ONLINE STUDY _ STUDYHALLE #1
__과제 : JVM은 무엇이며 자바 코드는 어떻게 실행하는 것인가.__  
__목표 : 자바 소스 파일(.java)을 JVM으로 실행하는 과정 이해하기.__

---


## JVM이란?  

`“Write once, run anywhere."`  

JVM(Java Virtual Machine)은 자바로 작성된 애플리케이션을 실행하기 위한 가상머신을 말한다.

자바는 OS의 메모리 영역에 직접 접근하지 않고 JVM을 통해 간접적으로 접근한다. OS의 메모리 영역에 직접 접근하는 C와 같은 언어가 할당받았던 메모리를 명시적으로 해제할 필요가 있는 반면, 자바는 JVM에 의해 자동적으로 메모리가 관리된다.
또한, 자바 바이트코드를 OS에 맞게 해석해주는 중개자 역할을 하여 자바 애플리케이션이 OS와 하드웨어에 독립적으로 사용 가능하도록 한다. (** JVM은 OS에 종속적이다.)


## 컴파일, 실행 방법

1. JDK를 설치한다.
2. 환경변수를 설정한다.
3. javac.exe → 클래스파일로 컴파일한다.
4. java.exe →  실행한다.
5. hello world ;-)

~~하지만 우리에겐 IDE가 있지...!😏~~


## Bytecode란?

자바 컴파일러에 의해 컴파일 된 자바코드를 의미하며, 자바코드를 배포하는 가장 작은 단위이다. 자바 컴파일러에 의해 변환되는 코드의 명령어 크기가 1바이트라서 바이트코드라고 불린다. 사용자 언어와 기계어 사이의 중간 언어로 볼 수 있으며, 실행엔진(Execution Engine)에 의해 기계가 실행할 수 있는 형태로 변환된다.

## JIT 컴파일러란?
> 하단 JVM 구성요소 내 Execution Engine 항목 참조


## JVM의 구성 요소


<br><img src="1.JPG" width="60%">  
> ###### https://asfirstalways.tistory.com/158  
<br>

### *▶ Class Loader, 클래스로더*   
바이트코드를 읽어서 Runtime Data Area에 적재하는 역할을 한다. 자바는 컴파일타임이 아닌 런타임에, 즉 클래스를 처음으로 참조할 때 해당 클래스를 로드하고 링크하는데, 이러한 동적 로드를 담당하는 부분이 클래스로더이다.

### *▶ Execution Engine, 실행엔진*
클래스를 실행시키는 역할을 하며, 바이트코드를 JVM내부에서 기계가 실행할 수 있는 형태로 변경한다.  
이 때 사용되는 방식에는 두 가지가 있는데 Interpreter방식과 JIT방식이다.  

- __Interprete__  
바이트코드를 명령어 단위로 읽어서 실행하는 방식. 수행속도가 느리다는 단점이 있다.  
  
- __JIT (Just-In-Time)__  
바이트 코드를 런타임 시점에 기계어로 반환해 주는 방식으로, 인터프리터방식의 단점을 보안하기 위해 도입되었다.  
실행엔진은 최초에는 인터프리터 방식(명령어 단위)으로 실행되며, 일정 기준을 넘어가는 시점에 바이트코드 전체를 컴파일 하여 네이티브코드로 변경한 후 네이티브 코드로 직접 실행한다. 네이티브코드는 캐시에 보관되기 때문에 한 번 컴파일 된 후에는 빠르게 수행이 가능하다. 그러나 JIT 컴파일러의 컴파일 과정 자체는 인터프리팅보다 오래 걸리므로, 해당 메서드가 얼마나 자주 수행되는지 체크하여 일정빈도를 넘을 때 JIT에 의한 컴파일을 수행한다.

### *▶ Runtime Data Areas, 런타임 데이터 영역*


<br><img src="2.JPG" width="40%">  
> ###### https://asfirstalways.tistory.com/158  
<br>


프로그램을 수행하기 위해 OS에서 할당받는 메모리영역이다.  
PC Register, JVM Stack, Native Method Stack은 스레드마다 하나씩 생성되며 Heap, Method Area는 모든 스레드가 공유하여 사용한다.

- __PC Register__  
스레드가 어떤 부분을 어떤 명령으로 실행해야 할 지에 대해 기록하는 부분으로, 스레드가 시작될 때 생성된다.  
현재 수행중인 JVM명령의 주소를 갖는다.

- __JVM Stack__  
프로그램 실행과정에서 임시로 할당되었다가 메서드를 빠져나가면 바로 소멸되는 데이터를 저장하는 영역으로 스레드가 시작될 때 생성된다. 각종 형태의 변수, 리턴값, 임시데이터, 스레드, 메서드 정보 등을 저장한다. 메서드 호출 시마다 각각의 스택프레임이 생성되고, 메서드가 종료되면 스택프레임은 제거된다. 

- __Native method stack__  
실제 실행가능한 기계어로 작성된 프로그램을 실행시키는 영역으로, Java가 아닌 다른 언어(주로 C, C++)로 작성된 네이티브 코드를 위한 공간이다.  

- __Method Area (Class Area, Static Area)__  
클래스정보를 처음 메모리공간에 올릴 때 초기화되는 대상을 저장하기 위한 메모리 공간으로 JVM이 시작될 때 생성된다.  
JVM이 읽어들인 클래스와 인터페이스 등에 대한 런타임 상수 풀, 필드와 메서드정보, static 변수, 메서드 등의 바이트코드를 보관한다.
> 런타임 상수 풀 : 클래스와 인터페이스의 상수, 메서드, 필드에 대한 모든 레퍼런스를 담고있는 테이블로 JVM이 어떤 메서드나 필드를 참조할 때 런타임 상수 풀을 통해 해당 메서드나 필드의 실제 메모리상 구조를 찾아서 참조한다.

- __Heap__  
참조형 데이터타입(객체, 인스턴스)을 저장하는 가상 메모리 공간으로, new 연산자로 생성된 객체와 배열을 저장한다.
Method Area에 올라온 클래스들만 객체로 생성가능하며 더 이상 사용되지 않는 객체나, 명시적으로 선언 된 NULL을 대상으로 가비지컬렉터가 작동된다.


## JDK와 JRE
#### JRE (Java Runtime Environment)  
자바로 작성된 응용프로그램이 실행되기 위한 최소환경으로, JVM과 클래스라이브러리로 구성된다.

#### JDK (Java Development Kit)  
자바 개발자용 도구로, JRE를 포함하여 컴파일러, 개발에 필요한 실행파일 등으로 구성된다.


---


#### REFERENCE
https://asfirstalways.tistory.com/158  
https://d2.naver.com/helloworld/1230  
https://yaboong.github.io/java/2018/06/09/java-garbage-collection/  
https://rumor1993.tistory.com/34  
http://tcpschool.com/java/java_intro_programming
